#include <Arduino.h>
#include "mbedtls/aes.h"
#include "AESCrypto.h"

unsigned char outputAES[1000]; //buffer output
AESCrypto* aesCrypto;

void setup(){
    //init aes mode
    Serial.begin(115200);
    aesCrypto = new AESCrypto();
    char * key = "abcdefghijklmnop";                                                                                     //key len 16 and input len 16
    unsigned char iv[] = {0xff, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 0x09, 0x0a, 0x0b, 0x0c, 0x0d, 0x0e, 0x0f};
    aesCrypto->init(key,iv);
    unsigned char input[] = "Test aes cbc mode in esp32 test 123 01 - test 02 - test - 03 -stack2- test3";
    int len = sizeof(input)/sizeof(unsigned char)-1;
    int new_len = aesCrypto->encryptCBC(input,len,outputAES);
    Serial.println("\nDone");
    for(int i=0;i<new_len;i++){
        Serial.printf("%2x",outputAES[i]);
    }
    aesCrypto->free();
}

void loop(){

}
